---
title: "Daytime Observations"
format: 
  html:
    echo: false
editor: visual
---

```{r}
#| label: setup
#| message: false

library(sf)
library(tidyverse)
sightings <- readRDS(here::here("data", "sightings.rds"))
waypoints <- read_csv(here::here("data", "Waypoints.csv"))
waypoints_sf <- st_as_sf(waypoints, 
                         coords = c("Lon_dec", "Lat_dec"),
                         crs = "epsg:4326")
```

## **Species counts**

Excluding July 16, which revisited transect 15-16 and accounts for 75% of total sightings due to anomalous diving petrel aggregation. Only species with 15+ individuals shown here.

```{r}
#| label: species_counts

counts <- sightings %>% 
  filter(transect != "1516b") %>% 
  group_by(species) %>% 
  summarize(count = sum(count))

filter(counts, count >= 15) %>% 
  mutate(species = fct_reorder(species, desc(count))) %>% 
  ggplot(aes(species, count)) +
  geom_col() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45),
        axis.title.x = element_blank())

```

## Species distributions

Maps of the 6 most numerous taxa: diving petrels (CODP+UNDP), fur seals, giant petrels (NGPT+SGPT+UGPT), cape petrels, South Georgia cormorants, and blue petrels. Also excludes July 16.

```{r}
#| label: species_maps
#| out-width: 100%

top_6 <- sightings %>% 
  filter(transect != "1516b") %>% 
  mutate(group = case_when(
    species %in% c("CODP", "UNDP") ~ "Diving petrel",
    species == "FUSE" ~ "Fur seal",
    species %in% c("UGPT", "NGPT", "SGPT") ~ "Giant petrel",
    species == "CAPT" ~ "Cape petrel",
    species == "SGCO" ~ "Cormorant",
    species == "BLPT" ~ "Blue petrel"
  )) %>% 
  drop_na(group) %>% 
  st_as_sf(coords = c("lon", "lat"), crs = "epsg:4326")

top_6 %>% 
  arrange(desc(count)) %>% 
  ggplot() +
  geom_sf(aes(size = count), color = "navy") +
  geom_sf(color = "grey80", shape = 21, size = 0.1) +
  geom_sf(data = filter(waypoints_sf, Waypoint > 10), 
          shape = 21,
          color = "black",
          fill = "gold") +
  scale_x_continuous(breaks = seq(-35.6, -35, by = 0.2)) +
  facet_wrap(~ group, nrow = 1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
        panel.background = element_rect(color = "grey80", fill = NA),
        strip.background = element_rect(fill = "grey80", color = NA))

```
